<!--
    Copyright (C) 2016 Sam Kumar, Michael Andersen, and the University
    of California, Berkeley.

    This file is part of Mr. Plotter (the Multi-Resolution Plotter).

    Mr. Plotter is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as published
    by the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Mr. Plotter is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.
    You should have received a copy of the GNU Affero General Public License
    along with Mr. Plotter.  If not, see <http://www.gnu.org/licenses/>.
-->

<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>uPMU Plotting Application</title>

        <link rel="stylesheet" type="text/css" href="anytime/css/anytime.5.0.3.css">
        <link rel="stylesheet" type="text/css" href="jquery-simplecolorpicker/css/jquery.simplecolorpicker.css">
        <link rel="stylesheet" type="text/css" href="vakata-jstree/themes/default/style.min.css">
        <link rel="stylesheet" type="text/css" href="bootstrap-3.3.6/css/bootstrap.css">
        <link rel="stylesheet" type="text/css" href="mr-plotter/css/s3ui.css">
    </head>

    <body>
        <div class="navbar navbar-default" role="navigation">
    <div class="navbar-header">
      <a class="navbar-brand" href="/"><img src="images/psl_20px.png" width="auto" height="20px" style="float: left; margin-right: 5px;"> Power Sensors Ltd.</a>
    </div>
    <div class="navbar-collapse collapse" style='height: 50px;'>

      <ul class="nav navbar-nav" style="height:50px;">
          <li style="margin:15px;">
              <a id="helpbtn" tabindex="0" data-container="body" data-toggle="popover" data-trigger="focus" data-placement="bottom" data-html="true" data-content="<p>View the <a href='/documents/Quickstart%20Kit%20-%20First%20Steps%20-%20Revision%2014.pdf' target='_blank'>First Steps</a> manual</p><p>View the <a href='/documents/Quickstart%20Kit%20-%20Administrator%20Manual%20-%20Revision%2017.pdf' target='_blank'>Administrator</a> manual</p><p>View the <a href='/documents/microPMU%20Installation%20and%20User%27s%20Manual%20-%20v2.0.pdf' target='_blank'>microPMU</a> user's manual</p><p>PSL assistance contact information:</p><ul><li>Office: +1-510-522-4400</li><li>Fax: +1-510-522-4455</li><li>Email: <a href='mailto:support@powerstandards.com' target='_top'>support@powersensorsltd.com</a></li></ul>">Help</a>
          </li>
      </ul>
      <ul class="nav navbar-nav" style="height:50px;">
          <li>
                <select id='language-picker' onchange="updateLanguage(this.value)" style='margin: 18px;'>
                    <option value='en'>English</option>
                    <!-- <option value='es'>Español</option> //-->
                    <option value='fr'>Français</option> <!--
                    <option value='de'>Deutsch</option>
                    <option value='ko'>한국어</option>
                    <option value='ja'>日本語</option>
                    <option value='zh'>中文</option>
                    <option value='pt'>Português</option>
                    <option value='vi'>Tiếng Việt</option> //-->
                </select>
          </li>
      </ul>

      <div style="float: right;">
      <ul class="nav navbar-nav">
          <li style='padding: 15px;'>
            <i>BTrDB &amp; uPMU Plotter </i><i data-localize='developed_by'>developed by</i> <i>U.C. Berkeley</i>
          </li>
      </ul>
      </div>

    </div>
  </div>

  <script type="text/javascript">
   function showPlotter () {
     $('#plotter-rows').fadeIn();
     $('#plot-directions').fadeOut();      
   }
   function hidePlotter () {
     $('#plotter-rows').fadeOut(150);
     $('#plot-directions').fadeIn(150)
   }
            function toggle_visibility(id) {
               var e = document.getElementById(id);
               if(e.style.display == 'block') {
                  $("#toggler").html( "&rarr; Show" );
                  e.style.display = 'none';
                  $("#toggle_column").animate({"width" : "0%"}, 500);
                  $("#chartDiv").animate({"width" : "100%"}, 500);
                } else {
                  $("#toggler").html( "&larr; Hide" );
                  e.style.display = 'block';
                  $("#toggle_column").animate({"width" : "100%"}, 500);
                  $("#container-fluid").animate({"width" : "100%"}, 500);
                }
            };

            function legend_toggler(id) {
              var toggler = $('#legend_toggler');
              var legendVisible = toggler.data('visible');
               if(legendVisible) {
                 $("#legend_toggler").html( "Show" );
               } else {
                 var selectedLegend = plotterSelf.idata.selectedLegendEntry;
                 if (selectedLegend) selectedLegend.click();
                 $("#legend_toggler").html( "Hide" );
               }
              toggler.data('visible', !legendVisible);
              if (plotterSelf.idata.selectedStreams.length)
                s3ui.updatePlot(plotterSelf);
            };
            function changeResolutionFreq() {
              var freq = $('input[name=frequency]:checked').val();
              if (freq) createCookie('frequency', freq, 365);
              if (freq == '60') {
                $('#half-cycle-resolution').val(0);
                $('#full-cycle-resolution').val(2);
              }
              else if (freq == '50') {
                $('#half-cycle-resolution').val(1);
                $('#full-cycle-resolution').val(3);
              }
              updateInput($('.resolutions').val());
            };
            function updateInput(p){
                // $("#resolutions").val(p);
                document.getElementById("resolutions").value = p;
            };

            function updateLanguage(l){
                 var opts = { language: l, pathPrefix: "/lang" };
                $("[data-localize]").localize("lang", opts);
                console.log("language changed to" + " " + l);
            };


            function copyToClipboard(elementId) {

                  // Create a "hidden" input
                  var aux = document.createElement("input");

                  // Assign it the value of the specified element
                  aux.setAttribute("value", document.getElementById(elementId).value);

                  // Append it to the body
                  document.body.appendChild(aux);

                  // Highlight its content
                  aux.select();

                  // Copy the highlighted text
                  document.execCommand("copy");

                  // Remove it from the body
                  document.body.removeChild(aux);

                }

                function createCookie(name,value,days) {
                    if (days) {
                        var date = new Date();
                        date.setTime(date.getTime() + (days*24*60*60*1000));
                        var expires = "; expires=" + date.toUTCString();
                    }
                    else var expires = "";
                    document.cookie = name + "=" + value + expires + "; path=/";
                }

                function readCookie(name) {
                    var nameEQ = name + "=";
                    var ca = document.cookie.split(';');
                    for(var i=0;i < ca.length;i++) {
                        var c = ca[i];
                        while (c.charAt(0)==' ') c = c.substring(1,c.length);
                        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
                    }
                    return null;
                }

                function eraseCookie(name) {
                    createCookie(name,"",-1);
                }
                //http://stackoverflow.com/a/4825695
        //-->


        </script>

        <style type='text/css'>
            .1legend_item { display: inline; margin-left: 40px; }

            .1legend {
                padding: 5px;
                font: 10px sans-serif;
                background: yellow;
                box-shadow: 2px 2px 1px #888;
            }

            #helpbtn {
                padding: 1px 6px;
                font-size: 12px;
                color: #333;
                background-color: #fff;
                text-align: center;
                vertical-align: middle;
                border: 1px solid #ccc;
                border-radius: 4px;
                cursor: pointer;
            }

            #helpbtn:hover {
                background-color: #e6e6e6;
                border-color: #adadad;
            }


                .progress {
                    border: 2px solid #5e96e4;
                    height: 20px;
                    width: inherit;
            }

                /*   DISK USAGE UPDATES HERE */

                .progress .prgbar {
                        background: #A7C6FF;
                        width: 70%;
                        position: relative;
                        height: 20px;
                        z-index: 999;
                }
                .progress .prgtext {
                        color: #000;
                        text-align: center;
                        font-size: 12px;
                        margin-left: 3px;
                        padding: 1px 0 0;
                        position: absolute;
                        z-index: 1000;
                }
                .progress .prginfo {
                        margin: 3px 0;
                }


        </style>

        <div id="plotter">
            <div class="well">
                <h4>Loading...</h4>
            </div>

            <script src="jquery/js/jquery-1.12.0.min.js"></script>
            <script src="jquery-migrate/js/jquery-migrate-1.3.0.js"></script>
            <script src="anytime/js/anytime.5.0.3.js"></script>
            <script src="sortable/Sortable.min.js"></script>
            <script src="jstz/jstz.min.js"></script>
            <script src="d3/js/d3.js"></script>
            <script src="jquery-simplecolorpicker/js/jquery.simplecolorpicker.js"></script>
            <script src="timezone-js/js/date.js"></script>
            <script src="timezone-js/js/init.js"></script>
            <script src="vakata-jstree/js/jstree.min.js"></script>
            <script src="jquery-localize/jquery.localize.min.js"></script>

            <!-- <script src="col-resizable/js/colResizable-1.3.med.js"></script>  //-->
            <script src="col-resizable/js/colResizable-1.3.source.js"></script>

            <script src="bootstrap-3.3.6/js/bootstrap.min.js"></script>
            <script src="mr-plotter/js/s3ui.js"></script>
            <script src="mr-plotter/js/axis.js"></script>
            <script src="mr-plotter/js/data.js"></script>
            <script src="mr-plotter/js/utils.js"></script>
            <script src="mr-plotter/js/plot.js"></script>
            <script src="mr-plotter/js/frontend.js"></script>
            <script src="mr-plotter/js/streamtree.js"></script>
            <script src="mr-plotter/js/control.js"></script>
            <script src="mr-plotter/js/cursors.js"></script>
            <script src="mr-plotter/js/requester.js"></script>

            <script>

             Date.prototype.stdTimezoneOffset = function() {
               var jan = new Date(this.getFullYear(), 0, 1);
               var jul = new Date(this.getFullYear(), 6, 1);
               return Math.max(jan.getTimezoneOffset(), jul.getTimezoneOffset());
             };

             Date.prototype.dst = function() {
               return this.getTimezoneOffset() < this.stdTimezoneOffset();
             };
             
             plotterSelf = null;
             $(function () {
               
                var plotterelem = document.getElementById("plotter");
                plotterelem.innerHTML = ""; // Remove "Loading..." text

               plotterSelf = mr_plotter(document.getElementById("plotter"), "mrplotter", undefined, undefined);

               $('#plotter-rows').hide();
                //set default frequency from cookie
                var defaultFreq = readCookie('frequency');

                if (!defaultFreq) {
                  defaultFreq = 60;
                  createCookie('frequency', defaultFreq, 365);
                }

                var freqOpt = $('#freq-'+defaultFreq+'hz');
                if (freqOpt) freqOpt.click();

                //initialize sortable legend
                var legendTable = document.querySelector('.legend.sortable');
                Sortable.create(legendTable, {
                  handle: '.reorder-legend',
                  draggable: 'tr',
                  onEnd: function (e) {
                    const streams = plotterSelf.idata.selectedStreams;
                    if (e.newIndex >= streams.length) {
                      var k = e.newIndex - streams.length;
                      while ((k--) + 1) {
                        streams.push(undefined);
                      }
                    }
                    streams.splice(e.newIndex, 0, streams.splice(e.oldIndex, 1)[0]);
                    plotterSelf.idata.selectedStreams = streams;
                    s3ui.updatePlot(plotterSelf);
                  }
                });

                //init tabs
                $('#plotter-tabs').tab();
                $('#plotter-tabs-nav a').click(function (e) {
                  e.preventDefault();
                  $(this).tab('show');
                });

                //init timezone
                function autoTimezone () {
                  var defaultTz = jstz.determine().name();
                  createCookie('timezone', defaultTz, 365);
                  document.getElementById('timezone-dropdown').value = defaultTz;
                }

               function autoDST () {
                 var dst = (new Date()).dst();
                 $('#dst-checkbox')[0].checked = dst;
                 createCookie('dst', dst, 365);
               }
                
                var defaultTz = readCookie('timezone');

                if (defaultTz) document.getElementById('timezone-dropdown').value = defaultTz;
               else autoTimezone();

               var defaultDST = readCookie('dst');
               if (defaultDST) $('#dst-checkbox')[0].checked = (defaultDST != 'false') ? true : false;
               else autoDST();
                
                $('#timezone-dropdown').change(function (e) {
                    if (plotterSelf.idata.selectedStreams.length) {
                        $('.plotButton').click();
                        createCookie('timezone', e.currentTarget.value, 365);
                        $(".showAll").click();
                    }
                });

                $('#auto-timezone').click(function(e) {
                    e.preventDefault();
                    autoTimezone();
                    autoDST();
                    if (plotterSelf.idata.selectedStreams.length) {
                        $('.plotButton').click();
                        $(".showAll").click();
                    }
                });

                //size streamtree
               var streamWell = $('.streamSelection');
               var streamTree = $('.streamTree');
               var chartWell = $('#chartDiv');
               var streamTreeHeight = chartWell.height() - streamWell.height() - 15;

                streamTree.css('min-height', streamTreeHeight);

                //init buttons
                $('[data-toggle="popover"]').popover();

                $( "div#all_scale" ).click(function() {
                  $('div[class^="autoscalebutton"]').click()
                  // $( ".autoscalebutton" ).click();
                  // console.log("autoscale!");
                });

                $( "div#all_scale1" ).click(function() {
                  $('div[class^="autoscalebutton"]').click()
                  // $( ".autoscalebutton" ).click();
                  // console.log("autoscale!");
                });
              });

                $.getJSON( "disk_usage.json", function( data_usage ) {
                  var items = [];
                  for (disk in data_usage['diskarray']) {
                      if (data_usage['diskarray'][disk]['mount'] == "/ssd") {
                          var space_available = data_usage['diskarray'][disk]['spaceavail'];
                          var space_total = data_usage['diskarray'][disk]['spacetotal'];
                      }
                  }
                  var space_remaining = space_available/space_total;
                  var space_free = space_total - space_available;
                  var space_remaining_gb = space_available/1024/1024;

                  function bytesToSize(bytes) {
                       var sizes = ['KB', 'MB', 'GB', 'TB'];
                       if (bytes == 0) return '0 Byte';
                       var i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
                       return Math.round(bytes / Math.pow(1024, i), 2) + '' + sizes[i];
                    };

                  $(".prgbar").width( 100 - (space_remaining).toFixed(2)*100 +"%");
                  // $(".prgbar").width( (100) +"%");
                  $(".prgtext").html(Math.round(100 - (space_remaining * 100)).toString().substring(0,5) +"% <span data-localize='space_used'>used</span> ( " + bytesToSize(space_total - space_available) + " of " + bytesToSize(space_total) + " )" );
                  if (Math.round(100 - (space_remaining * 100)) >= 90) {
                      $(".prgbar").css("background", "#ff0000");
                      $(".progress").css("border-color", "#990000");
                  } else if (Math.round(100 - (space_remaining * 100)) >= 85) {
                      $(".prgbar").css("background", "#ffa500");
                      $(".progress").css("border-color", "#996300");
                  } else if (Math.round(100 - (space_remaining * 100)) >= 80) {
                      $(".prgbar").css("background", "#ffd700");
                      $(".progress").css("border-color", "#998100");
                  }

                  if ((space_remaining_gb) <= 20) {
                      $("<p>No longer accepting new data</p><p>Drive is full</p>").insertAfter(".progress");
                  }

$('#err-alert').hide();
                });

            </script>

        </div>
        <script type="text/javascript">
         closeOverlayAlert = function () {
           $('#err-overlay').removeClass('visible');
         };
        </script>        
        <div id="err-overlay" onclick="closeOverlayAlert()">
          <div id="err-alert" class="alert alert-danger" role="alert">
            <button type="button" class="close" aria-label="Close" onclick="closeOverlayAlert()"><span aria-hidden="true">&times;</span></button>
            <span id="err-message"></span>
          </div>
        </div>

        <footer>

            <div class="container" style="width: 100%;">
                <p class="text-muted">
                    The Multi-Resolution Plotter "Mr. Plotter"&nbsp;&nbsp;Copyright &copy; 2016 Sam Kumar, Michael Andersen, and the University of California, Berkeley.<br>
                    This program comes with ABSOLUTELY NO WARRANTY.<br>
                    This is free software and you are welcome to redistribute it under certain conditions. Click
                    <a href="http://www.gnu.org/licenses/agpl.html" target="_blank">here</a> for details.
                </p>
                <p class="text-muted">
                  PingThings provides both free support and commercial support contracts for this software. We encourage you to provide feedback via the form in the lower right or directly at support@pingthings.io
              </p>
            </div>
        </footer>
        <script type="text/javascript">
          window.doorbellOptions = {
              appKey: 'eqRSDF7RF4A6ywtFtmQsA751EX7UuL9nQB2DZqMO4PJYSFlYqmYYgGDIRiQyghqo'
          };
          (function(w, d, t) {
              var hasLoaded = false;
              function l() { if (hasLoaded) { return; } hasLoaded = true; window.doorbellOptions.windowLoaded = true; var g = d.createElement(t);g.id = 'doorbellScript';g.type = 'text/javascript';g.async = true;g.src = 'https://embed.doorbell.io/button/7313?t='+(new Date().getTime());(d.getElementsByTagName('head')[0]||d.getElementsByTagName('body')[0]).appendChild(g); }
              if (w.attachEvent) { w.attachEvent('onload', l); } else if (w.addEventListener) { w.addEventListener('load', l, false); } else { l(); }
              if (d.readyState == 'complete') { l(); }
          }(window, document, 'script'));
        </script>    
    </body>
</html>

<template id="mrplotter">
    <noscript>You must enable Javascript to interact with the plotting tool.</noscript>




    <div class="login">
                        <div id="toggler" class="btn btn-link" style='float: left; margin-left: 10px; margin-right: 10px;' onclick="toggle_visibility('toggle_column');">&larr; Hide</div>

                        <h3 style='float: left; margin-left: 10px; margin-right: 10px; padding-top: 0px; padding-bottom: none; margin-top: 4px;'>MicroPMU Plotting Application v1.4.7</h3>

                        <!--
                        <div class="btn btn btn-primary" style='float: left; margin-right: 10px;' onclick='$( ".showAll" ).click();'>Plot all Data</div>
                            //-->

                        <div id="all_scale" data-localize='autoscale_all' class="btn btn-info" style='float: right; margin-right: 25px;' onclick='$( ".autoscalebutton" ).click();'>&varr; Autoscale All &varr;</div>

                        <!-- <div id="all_scale1" class="btn btn-success" style='float: left; margin-right: 25px;' onclick='$( ".autoscalebutton" ).click();'>Autoscale All</div>
                            //-->


                        <div class="showAll btn btn-primary" style='float: right; margin-right: 10px;' data-localize='zoom_all'>&harr; Zoom Out Time &harr;</div>


                        <div class="logindiv btn-group" style="width: 100px; float: left; margin-right: 10px;">
                            <div class="loginMenu btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="loginButtonText" data-localize='login'></span><span class="caret"></span>
                            </div>
                            <ul class="dropdown-menu loginList" style="width: 257px;">
                                <li><input type="text" class="loginstate-start loginbox form-control username" placeholder="Username"></input></li>
                                <li><input type="password" class="loginstate-start loginbox form-control password" placeholder="Password"></input></li>
                                <li><input type="password" class="loginstate-changepw loginbox form-control oldpassword" placeholder="Current Password"></input></li>
                                <li><input type="password" class="loginstate-changepw loginbox form-control newpassword1" placeholder="New Password"></input></li>
                                <li><input type="password" class="loginstate-changepw loginbox form-control newpassword2" placeholder="New Password (Again)"></input></li>

                                <li><div class="loginmessage"></div></li>
                                <li role="separator" class="divider loginstate-start"></li>
                                <li><div class="loginstate-start loginButton btn btn-primary" style="width: 100%;">Sign In</div></li>

                                <li>
                                    <div class="loginstate-loggedin btn-group-vertical" style="width: 100%;">
                                        <div class="changepwMenu btn btn-warning" style="width: 100%;">Change Password</div>
                                        <div class="logoffButton btn btn-danger" style="width: 100%;">Sign Out</div>
                                    </div>
                                </li>

                                <li role="separator" class="divider loginstate-changepw"></li>
                                <li><div class="loginstate-changepw changepwButton btn btn-success" style="width: 100%;">Confirm Change</div></li>
                            </ul>
                        </div>
                        <div style='clear: both;'></div>
                        <hr>
    </div>


    <table class="dispTable" width="99%">
        <tr valign="top">
            <td width="18%" id='toggle_column' style='width: 100%; display: block;'>
                <div class="leftColumn" id="leftColumn">
                    <!-- STREAM SELECTION MENU -->



                    <div class="streamSelection">

                      <div class="well">
                        <h3 style="margin-top:0px;" data-localize='select_streams'>Select Streams
                          <div style='float: right; margin-top: -4px; margin-bottom: 10px;' class="streamTreeOptions btn-group">
                            <div style='display: none;' class="refreshStreamTree btn btn-default">Refresh</div>
                            <div onClick="window.location.reload();" class="btn btn-default">Deselect All</div>
                            <div style='display: none;' class="deselectStreamTree btn btn-default">Deselect All</div>
                            <!-- <div class="deselectStreamTree btn btn-default">Deselect All</div> //-->
                          </div></h3>                        
                        <div class="streamTree" style="background: white; padding-top:5px;"></div>
                        <hr>
                        <div class='progress'>
                          <div class='prgtext'>Disk Usage</div>
                          <div class='prgbar'></div>
                          <div class='prginfo'>
                            <span style='float: left;'></span>
                            <span style='float: right;'></span>
                            <span style='clear: both;'></span>
                          </div>
                        </div>
                        <div style='clear: both;'></div>                    
                        <div class="infoBar">
                          <div class="plotLoading" style="width: 100%; margin-top: 20px; font-size: 1.25em;"></div> <!-- Displays details about how the plot is loading -->
                        </div>
                      </div>
                    </div>




                        <!-- <div class="btn btn-primary" style='float: right; margin-right: 10px;' onclick='$( ".showAll" ).click();'>Plot all Data</div> //-->


                </div>
            </td>
            <td width="80%">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12" id='chartDiv' style=''>
                          <div class="well chartContainer" id="chart_interface">                                    
                                <!-- THE ACTUAL CHART -->
                                <svg class="chart" width="800" height="430" background="white">
                                    <rect width="800" height="430" class="background-rect" fill="white"></rect>  <!-- The background is white, not transparent. -->

                                </svg>
                                <div id="plot-directions">
                                  <img src="images/qs_start_up.jpg" >
                                </div>

                            <noscript>You must enable Javascript in order to use this plotting tool.</noscript>

                            <style class="plotStyles">
                                    polyline.streamRange {
                                        fill: inherit;
                                        fill-opacity: inherit;
                                        stroke: none;
                                    }
                                    polyline.streamMean {
                                        fill: none;
                                        stroke: inherit;
                                        stroke-opacity: 1;
                                        stroke-width: inherit;
                                    }
                                    circle.streamPoint {
                                        fill: inherit;
                                        stroke: inherit;
                                        fill-opacity: 1;
                                        stroke-opacity: 1;
                                        stroke-width: inherit;
                                    }
                                    rect.scrollDisabled {
                                        visiblity: hidden;
                                    }
                                    path, line {
                                        fill: none;
                                        stroke: black;
                                        shape-rendering: crispEdges;
                                    }
                                    /*
                                    text.title {
                                        font-size: 20px;
                                    }
                                    text.label {
                                        font-size: 12px;
                                    }
                                    text.cursorlabel {
                                        font-size: 16px;
                                    }
                                    g.tick text {
                                        font-size: 16px;
                                    }
                                    g.data-density-axis text {
                                        font-size: 14px;
                                    }
                                    */
                                    svg * {
                                        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
                                        font-size: 14px;
                                        font-weight: normal;
                                    }
                                    text.label {
                                        font-size: 14px;
                                        font-weight: normal;
                                    }
                                    rect.clickscreen {
                                        pointer-events: visibleFill;
                                        fill: none;
                                    }
                                </style>

                                <style class="dynamicStyles">
                                </style>


                                <script type='text/javascript'>
                                    function GetIEVersion() {
                                      var sAgent = window.navigator.userAgent;
                                      var Idx = sAgent.indexOf("MSIE");
                                      // If IE, return version number.
                                      if (Idx > 0)
                                        return parseInt(sAgent.substring(Idx+ 5, sAgent.indexOf(".", Idx)));

                                      // If IE 11 then look for Updated user agent string.
                                      else if (!!navigator.userAgent.match(/Trident\/7\./))
                                        return 11;

                                      else
                                        return 0; //It is not IE

                                    }
                                    if ((GetIEVersion() > 0) || (navigator.userAgent.toLowerCase().indexOf('firefox') > -1)){
                                      document.write("<style type='text/css'>#makeG { display: none; }</style>");
                                      // alert("This is IE " + GetIEVersion());
                                    } else {
                                      // alert("This is not IE ");
                                    }
                                </script>
                            </div>
         
                        </div>

                    </div>

                    <div id="plotter-rows" style="display: none;">

                    <!-- EXPORT TO CSV -->                    
                    <div class="row">

                        <div class=" col-md-12">
                          <div class="well">
                            <h3 data-localize="export" style="margin-top:0px;">Export</h3>
                            <table width='100%'>
                              <tr>
                                <td width='50%'>


                                  <div class="graphExport">
                                    <div class="btn-group-horizontal">
                                      <div class="makecsv btn btn-success" data-localize='export_csv'>Export Graph to CSV File</div>&nbsp;&nbsp;
                                      <div id="makeG" class="makeGraph btn btn-success" data-localize='export_svg'>Save Graph as Image</div>
                                    </div>
                                    <div class="download-graph"></div>
                                    <div class="modal fade csv-modal" role="dialog" tabindex="-1" aria-hidden="true">
                                      <div class="modal-dialog">
                                        <div class="modal-content">
                                          <div class="modal-header">
                                            <div class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></div>
                                            <div class="csv-settings">
                                              <!-- <h4>1. Select the streams to include in the CSV file.</h4> //-->
                                              <div class="csv-streams"></div>

                                              <h4>Export to CSV File</h4>

                                              <div class="csv-pointwidth">
                                                <p>
                                                  Data frequency:<br>
                                                  <input id="freq-50hz" type="radio" name="frequency" value="50" onchange="changeResolutionFreq();"> 50Hz</input><br>
                                                  <input id="freq-60hz" type="radio" name="frequency" value="60" onchange="changeResolutionFreq();"> 60Hz</input>
                                                </p>
                                                Time per row in your CSV file:
                                                <select class="resolutions" oninput="updateInput(this.value)" onchange="updateInput(this.value)">
                                                  <option id="half-cycle-resolution">1/2 cycle</option>
                                                  <option id="full-cycle-resolution">1 cycle</option>
                                                  <option value="4">1 second</option>
                                                  <option value="5">1 minute</option>
                                                  <option value="6">5 minutes</option>
                                                  <option selected="selected" value="7">30 minutes</option>
                                                  <option value="8">1 hour</option>
                                                  <option value="9">1 day</option>
                                                </select>

                                                <input type="hidden" id="resolutions" min='0' max='9' class="windowwidth-selector" value="7"/>
                                                <div class="selected-windowwidth"></div>
                                                <div class="selected-window-desc"></div>
                                              </div>


                                              <!-- This form is not visible to the user, but is used to make the POST request for the CSV file. -->
                                              <form class="csv-form" method="post" style="display: none;" target="_blank" enctype="text/plain">
                                                <input class="csv-form-data" name="json" />
                                              </form>
                                            </div>
                                          </div>
                                          <div class="modal-footer">
                                            <div class="btn btn-default" data-dismiss="modal">Cancel</div>
                                            <div class="csv-button btn btn-primary" data-dismiss="modal">Create CSV File</div>
                                          </div>
                                        </div>
                                      </div>
                                    </div>                                    
                                  </div>

                                </td>
                                <td width='50%'>

                                  <!-- PERMALINK -->
                                  <div class="permalinkGenerate" style='float: right;'>
                                    <div class="getPermalink btn btn-success" data-localize='gen_permalink'>Generate Permalink</div>
                                    <input type="checkbox" class="includeMetadata" />
                                    <span data-localize='embed_metadata'>Embed Stream Metadata</span>
                                    <div class="permalink"></div>
                                    <!-- <input type='text' class="permalink" /> //-->
                                  </div>
                                </td>
                              </tr>
                            </table>
                          </div>
                        </div>                        
                    </div>
                    
                    <div id="plotter-tabs"  class="row">
                      <div class="col-md-12">                          
                          <ul id="plotter-tabs-nav" class="nav nav-tabs nav-justified" role="tablist">
                            <li role="presentation">
                              <a  aria-controls="legend-tab" data-target="#legend-tab" role="tab" data-toggle="tab">
                                <button id="legend_toggler" class="btn btn-info"  onclick="legend_toggler();" data-visible="true">Hide</button><h3 data-localize="legend">Legend</h3>
                              </a>
                                                            
                            </li>
                            <li role="presentation" class="active">
                              <a aria-controls="y-axes-tab" data-target="#y-axes-tab" role="tab" data-toggle="tab">
                                <h3 data-localize="axes">Axes</h3>
                              </a>
                            </li>
                            <li role="presentation">
                              <a aria-controls="time-tab" data-target="#time-tab" role="tab" data-toggle="tab">
                                <h3 data-localize="time">Time</h3>
                              </a>
                            </li>                            
                          </ul>

                        </div>
                          <div class="tab-content">
                            
                            <!-- STREAM LEGEND -->                          
                            <div role="tabpanel" id="legend-tab" class="tab-pane fade in active col-md-12">
                              <div class="well">                                
                                <div class="streamLegend">
                                  <table class="table table-striped">
                                    <thead>
                                      <tr>
                                        <th></th>
                                        <th data-localize='color'>Color</th>
                                        <th data-localize='stream'>Stream</th>
                                        <th data-localize='axis_name'>Axis Name</th>
                                        <th data-localize='progress'>Progress</th>
                                      </tr>
                                    </thead>
                                    <tbody class="legend sortable"></tbody>
                                  </table>
                                </div>
                              </div>
                            </div>
                            
                            <!-- AXIS LEGEND -->                          
                            <div role="tabpanel" id="y-axes-tab" class="tab-pane fade col-md-12">
                              <div class="well">
                                <div class="axisLegend">
                                  <div class="addAxis btn btn-success" style='float: right; margin-top: -2px; margin-bottom: 10px;' data-localize='add_y_axis'>Add a Y-Axis</div>
                                  <table class="table table-striped">
                                    <thead>
                                      <tr>
                                        <th data-localize='axis_name'>Axis Name</th>
                                        <th data-localize='stream'>Stream</th>
                                        <th data-localize='units'>Units</th>
                                        <th data-localize='axis_position'>&nbsp;Axis Position</th>
                                        <th data-localize='axis_scale'>&nbsp;Axis Scale</th>
                                        <th></th>
                                        <th data-localize='remove'>Remove</th>
                                      </tr>
                                    </thead>
                                    <tbody class="axes"></tbody>
                                  </table>
                                </div>
                                <div class="row">
                                  &nbsp;&nbsp;
                                  <!-- AUTOMATIC UPDATE OPTION -->
                                  <span class="automaticUpdate" style='display: none;' >
                                    <input type="checkbox" class="automaticAxisSetting" checked />
                                    <span>Automatically apply changes to settings</span>
                                  </span>
                                  <div class="btn btn-primary applySettingsButton" style="display: none;">
                                    Apply Settings
                                  </div>
                                </div>
                              </div>
                            </div>                            

                            <!-- TIME SELECTION -->
                            <div rol="tabpanel" id="time-tab" class="tab-pane fade col-md-12">
                              <div class="well">

                                  <div class="row text-center">
                                    
                                    <div id="manual-zoom" class="col-md-6">
                                      <h3 data-localize="manual_zoom">Manual Zoom</h3>
                                      <br>
                                      <form class="form-inline">
                                        <div class="form-group">
                                          <label for="start-date" data-localize='start_date'>Start Date</label>                                        
                                          <div class="input-group">

                                            <input id="start-date" type="text" class="form-control datefield startdate" />
                                            <div class="m1yButton input-group-addon" style="width:4em">-1Y</div>
                                          </div>
                                        </div>
                                      </form>
                                      <br>                                      
                                      <form class="form-inline">
                                        <div class="form-group">
                                          <label for="end-date" data-localize='end_date'>End Date</label>
                                          <div class="input-group">
                                            <input id="end-date" type="text" class="form-control datefield enddate">
                                            <div class="nowButton  input-group-addon" style="width:4em">Now</div>
                                          </div>

                                        </div>
                                      </form>
                                      <br>
                                        <div class="btn btn-primary" data-localize='manual_zoom' onclick="$( '.plotButton' ).click();">&larr; Manual Zoom &rarr; </div>
                               
                                    </div>
                                    <div class="col-md-6">
                                      <form class="form">
                                      <div class="form-group">
                                        <h3 data-localize='timezone'>Timezone</h3>
                                        <br>
                                        <div class="input-group " style="width: 100%;">
                                          <div class="col-md-6 col-md-offset-2">
                                          <select id="timezone-dropdown" class="timezoneSelect form-control">
                                            <option value="Pacific/Midway">Pacific/Midway</option>
                                            <option value="Pacific/Honolulu">Pacific/Honolulu</option>
                                            <option value="America/Anchorage">America/Anchorage</option>
                                            <option value="America/Los_Angeles">America/Los_Angeles</option>
                                            <option value="America/Denver">America/Denver</option>
                                            <option value="America/La_Paz">America/La_Paz</option>
                                            <option value="America/Phoenix">America/Phoenix</option>
                                            <option value="America/Chicago">America/Chicago</option>
                                            <option value="America/Winnipeg">America/Winnipeg</option>
                                            <option value="America/Monterrey">America/Monterrey</option>
                                            <option value="America/Costa_Rica">America/Costa_Rica</option>
                                            <option value="America/New_York">America/New_York</option>
                                            <option value="America/Indiana/Indianapolis">America/Indiana/Indianapolis</option>
                                            <option value="America/Bogota">America/Bogota</option>
                                            <option value="America/Goose_Bay">America/Goose_Bay</option>
                                            <option value="America/Caracas">America/Caracas</option>
                                            <option value="America/Santiago">America/Santiago</option>
                                            <option value="America/St_Johns">America/St_Johns</option>
                                            <option value="America/Recife">America/Recife</option>
                                            <option value="America/Argentina/Buenos_Aires">America/Argentina/Buenos_Aires</option>
                                            <option value="America/Godthab">America/Godthab</option>
                                            <option value="Atlantic/South_Georgia">Atlantic/South_Georgia</option>
                                            <option value="Atlantic/Azores">Atlantic/Azores</option>
                                            <option value="Atlantic/Cape_Verde">Atlantic/Cape_Verde</option>
                                            <option value="Etc/UTC">Etc/UTC</option>
                                            <option value="Europe/London">Europe/London</option>
                                            <option value="Africa/Casablanca">Africa/Casablanca</option>
                                            <option value="Europe/Bucharest">Europe/Bucharest</option>
                                            <option value="Europe/Zagreb">Europe/Zagreb</option>
                                            <option value="Europe/Brussels">Europe/Brussels</option>
                                            <option value="Europe/Amsterdam">Europe/Amsterdam</option>
                                            <option value="Africa/Kinshasa">Africa/Kinshasa</option>
                                            <option value="Europe/Bucharest">Europe/Bucharest</option>
                                            <option value="Africa/Cairo">Africa/Cairo</option>
                                            <option value="Europe/Helsinki">Europe/Helsinki</option>
                                            <option value="Europe/Athens">Europe/Athens</option>
                                            <option value="Asia/Jerusalem">Asia/Jerusalem</option>
                                            <option value="Africa/Johannesburg">Africa/Johannesburg</option>
                                            <option value="Europe/Moscow">Europe/Moscow</option>
                                            <option value="Asia/Kuwait">Asia/Kuwait</option>
                                            <option value="Africa/Nairobi">Africa/Nairobi</option>
                                            <option value="Asia/Baghdad">Asia/Baghdad</option>
                                            <option value="Asia/Tehran">Asia/Tehran</option>
                                            <option value="Asia/Muscat">Asia/Muscat</option>
                                            <option value="Asia/Baku">Asia/Baku</option>
                                            <option value="Asia/Kabul">Asia/Kabul</option>
                                            <option value="Asia/Yekaterinburg">Asia/Yekaterinburg</option>
                                            <option value="Asia/Karachi">Asia/Karachi</option>
                                            <option value="Asia/Colombo">Asia/Colombo</option>
                                            <option value="Asia/Kathmandu">Asia/Kathmandu</option>
                                            <option value="Asia/Dhaka">Asia/Dhaka</option>
                                            <option value="Asia/Dhaka">Asia/Dhaka</option>
                                            <option value="Asia/Dhaka">Asia/Dhaka</option>
                                            <option value="Asia/Rangoon">Asia/Rangoon</option>
                                            <option value="Asia/Bangkok">Asia/Bangkok</option>
                                            <option value="Asia/Krasnoyarsk">Asia/Krasnoyarsk</option>
                                            <option value="Asia/Hong_Kong">Asia/Hong_Kong</option>
                                            <option value="Asia/Kuala_Lumpur">Asia/Kuala_Lumpur</option>
                                            <option value="Asia/Singapore">Asia/Singapore</option>
                                            <option value="Asia/Taipei">Asia/Taipei</option>
                                            <option value="Australia/Perth">Australia/Perth</option>
                                            <option value="Asia/Irkutsk">Asia/Irkutsk</option>
                                            <option value="Asia/Seoul">Asia/Seoul</option>
                                            <option value="Asia/Tokyo">Asia/Tokyo</option>
                                            <option value="Asia/Yakutsk">Asia/Yakutsk</option>
                                            <option value="Australia/Darwin">Australia/Darwin</option>
                                            <option value="Australia/Adelaide">Australia/Adelaide</option>
                                            <option value="Australia/Melbourne">Australia/Melbourne</option>
                                            <option value="Australia/Brisbane">Australia/Brisbane</option>
                                            <option value="Australia/Hobart">Australia/Hobart</option>
                                            <option value="Asia/Vladivostok">Asia/Vladivostok</option>
                                            <option value="Pacific/Guam">Pacific/Guam</option>
                                            <option value="Pacific/Noumea">Pacific/Noumea</option>
                                            <option value="Asia/Kamchatka">Asia/Kamchatka</option>
                                            <option value="Pacific/Nauru">Pacific/Nauru</option>
                                            <option value="Pacific/Tongatapu">Pacific/Tongatapu</option>                                            
                                            <!-- <option value="OTHER">Other:</option> -->
                                          </select>
                                          </div>
                                          <div class="col-md-3 text-center">
                                            <div class="checkbox skinny">
                                              <label>
                                                <input id="dst-checkbox" type="checkbox"> DST
                                              </label>
                                            </div>
                                          </div>
                                        </div>
                                        <input type="text" class="otherTimezone form-control" style="visibility: hidden;" />
                                        <br>
                                        <button id="auto-timezone" class="btn btn-info">Autodetect</button>                                        
                                      </div>
                                      </form>
                                    </div>
                                  </div>
                                  


                                <div class="row">
                                  <div class="plotButton btn btn-primary" style='visibility: hidden;'>Apply Date Range and Plot</div>
                                  <div class="resetZoom btn btn-default" style='visibility: hidden;'>Reset Zoom</div>
                                </div>
                              </div>
                            </div>

                            



                            
                          </div>

                    </div>
                    </div>
                </div>
            </td>
        </tr>
    </table>

</template>
